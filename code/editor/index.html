<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Code Editor</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    <script src="script.js" type="text/javascript" charset="utf-8"></script>

</head>
<body>
  <div id="header">
    <h1>Web-based Code Editor</h1>
  </div>
  <div id="content">
    <div id="options">
      <div id="language">
        Language: 
        <select id="languageselector" onchange="changeLanguage()">
          <option value="tcl">Tcl</option>
          <option value="xotcl">XOTcl</option>
          <option value="nx">NX</option>
        </select>
      </div>
      <div id="sample">
        Scripts: 
        <select id="scriptselector" onchange="changeScript()">
          <option value="none">none</option>
          <option value="nx">NX</option>
          <option value="xotcl">XOTcl</option>
        </select>
      </div>         
    </div>
    <div id="wrapper">
    <div id="editor"></div>
      <script src="src/ace.js" type="text/javascript" charset="utf-8"></script>
      <script>
        var editor = ace.edit("editor");
        editor.session.setMode("ace/mode/tcl");
        editor.setTheme("ace/theme/monokai");
      </script>
    </div>  
    <div id="operations">
      <input type="submit" value="Submit" onclick="submitScript()"/>
    </div>
    <pre id="result">
    </pre>
  </div>
  
<script type="text/editor" id="none"></script>

<textarea class="sample" id="nx">
#String
set y "xxxx" 
set y "xxxx "cssdsdsdsd" yyyy"

set x "xxxxxx
      sdsdasdasd
   ssadsadasd"

#variables
$name

$name(key)

${name} 

${subst}$itut(ions)

${:name}

#command substitution

set y [set x 1]

set y "[set x 1] hallo"

# comment \
asdf \
adsf

kein comment

set x 1; # my comment \
         dsdsdsdds

{*}
;
         
alle "strings" gehen mit " an und dann geht es weiter; entweder mit string oder eval oder variable" --> braucht aber einen eigenen next --> innerhalb der stringumgebung und extern

frage --> kann man mit einem 2. run dr√ºbergehen         


</textarea>

<textarea class="sample" id="xotcl">
#Hochreiner Christoph, 0726292

package require XOTcl
namespace import ::xotcl::*

set opt(-symbol) YHOO
array set opt $argv

Class WebPage -parameter {{url http://nm.wu-wien.ac.at/}}

WebPage instproc parseUrl {} {
  my instvar url hostname port path
  if {[regexp {http://([^/]+)(/?.*)} $url _ hostname path]} {
    if {![regexp ^(.*):(.*)$ $hostname _ hostname port]} {
      set port 80     ;# Standardannahme
    }
    if {$path == ""} {set path /}
  }
}

WebPage instproc loadPage {{headerFields ""}} {
  my instvar hostname port path content
  my parseUrl
  set stream [socket $hostname $port]
  puts $stream "GET $path HTTP/1.0"
  puts $stream "Host: $hostname"
  foreach {tag value} $headerFields {puts $stream "$tag: $value"}
  puts $stream ""
  flush $stream
  set content [read $stream]
  close $stream
}
WebPage instproc getContent {} {
  my instvar content
  if {![my exists content]} { my loadPage }
  return $content
}


Class Stock -parameter {{symbol ""}}

Stock instproc extractData {content} {
  my instvar timeVar rate bid ask openVar volume
  if {![regexp {<div class=\"rtq_div\">(.*)Add to Portfolio} $content _ header]} {
  	puts stderr "could not extract header"
  } else {
    regexp {time_rtq_ticker\"><[^>]*>(.*)</span></span> <span class=\"down_r} $header _ rate
  regexp {time_rtq\"> <[^>]*>(.*)</span></span>.*\|} $header _ timeVar
  }

  if {![regexp {<div id=\"yfi_quote_summary_data(.*)Avg Vol } $content _ data]} {
  	puts stderr "could not extract data part"
  } else {
    regsub -all {</?tr/?>} $data "" data
    regsub -all {</?td[^>]*>} $data "" data
    regsub -all {</?th[^>]*>} $data "" data
    regsub -all {</?span[^>]*>} $data "" data
    regsub -all {</?table[^>]*>} $data "" data
    regsub -all {</?small>} $data "" data
    
    regexp {Bid:(.*)Ask} $data _ bid
    regexp {Ask:(.*)1y} $data _ ask
    regexp {Open:(.*)Bid} $data _ openVar
    regexp {Volume:(.*)} $data _ volume
  }
}

Stock instproc printData {} {
  my instvar symbol timeVar rate bid ask openVar volume
  if {[my exists timeVar] && [info exists rate] && [info exists bid] && [info exists ask] && [info exists openVar] && [info exists volume]} {
   puts "The current rate of symbol $symbol at $timeVar is $rate with following details:"
   puts "Bid: $bid"
   puts "Ask: $ask"
   puts "Open: $openVar"
   puts "Volume: $volume"
  } else {
   puts stderr "The data could not be extracted for $symbol"
  }
}

WebPage stockinfo -url http://finance.yahoo.com/q?s=$opt(-symbol)&d=1b

Stock s -symbol $opt(-symbol)
s extractData [stockinfo getContent]
s printData
</textarea>

</body>
</head>
